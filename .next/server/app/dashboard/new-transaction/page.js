(()=>{var e={};e.id=479,e.ids=[479],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},63477:e=>{"use strict";e.exports=require("querystring")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},45104:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>l});var t=a(50482),s=a(69108),n=a(62563),o=a.n(n),i=a(68300),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);a.d(r,c);let l=["",{children:["dashboard",{children:["new-transaction",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,65814)),"/Users/salomon/Documents/Projects/kipo-app/src/app/dashboard/new-transaction/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,7784)),"/Users/salomon/Documents/Projects/kipo-app/src/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,5470)),"/Users/salomon/Documents/Projects/kipo-app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/salomon/Documents/Projects/kipo-app/src/app/dashboard/new-transaction/page.tsx"],u="/dashboard/new-transaction/page",p={require:a,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/new-transaction/page",pathname:"/dashboard/new-transaction",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},1874:(e,r,a)=>{let t={"5267d4393e59df6dc3ad8be98008f0631733a9a6":()=>Promise.resolve().then(a.bind(a,85556)).then(e=>e.createTransaction)};async function s(e,...r){return(await t[e]()).apply(null,r)}e.exports={"5267d4393e59df6dc3ad8be98008f0631733a9a6":s.bind(null,"5267d4393e59df6dc3ad8be98008f0631733a9a6")}},51695:(e,r,a)=>{Promise.resolve().then(a.bind(a,32047)),Promise.resolve().then(a.bind(a,54141))},32047:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>g});var t=a(95344),s=a(3729),n=a(22254),o=a(47674),i=a(5094),c=a(46540),l=a(63024);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,a(69224).Z)("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);var u=a(42739);a(13664);var p=(0,a(28371).$)("5267d4393e59df6dc3ad8be98008f0631733a9a6");let m=["Vivienda","Alimentaci\xf3n","Transporte","Servicios","Entretenimiento","Salud","Educaci\xf3n","Ropa","Personal","Mascotas","Deudas","Otros"],x=["Salario","Freelance","Inversiones","Venta","Regalo","Reembolso","Otros"];function g(){let e=(0,n.useRouter)(),{data:r,status:a}=(0,o.useSession)(),[g,h]=(0,s.useState)(!1),[y,f]=(0,s.useState)(""),[b,v]=(0,s.useState)(!1),[j,w]=(0,s.useState)(""),[q,S]=(0,s.useState)({type:"gasto",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],isRecurrent:!1,recurrenceFrequency:"none",tags:[]}),P=e=>{let{name:r,value:a,type:t,checked:s}=e.target;S(e=>({...e,[r]:"checkbox"===t?s:a}))},N=e=>{S(r=>({...r,tags:r.tags.filter(r=>r!==e)}))},k=async r=>{if(r.preventDefault(),f(""),v(!1),"authenticated"!==a){f("Debes iniciar sesi\xf3n para crear una transacci\xf3n");return}if(!q.amount||0>=parseFloat(q.amount)){f("El monto debe ser mayor a cero");return}if(!q.category){f("Debes seleccionar una categor\xeda");return}h(!0);try{let r=new FormData;Object.entries(q).forEach(([e,a])=>{Array.isArray(a)?a.forEach(a=>r.append(e,a)):"boolean"==typeof a?r.append(e,a?"on":"off"):r.append(e,String(a))});let a=await p(r);a.success?(v(!0),confirm("Transacci\xf3n creada con \xe9xito. \xbfQuieres agregar otra?")?S({type:"gasto",amount:"",category:"",description:"",date:new Date().toISOString().split("T")[0],isRecurrent:!1,recurrenceFrequency:"none",tags:[]}):e.push("/dashboard")):f(a.error||"Error al crear la transacci\xf3n")}catch(e){console.error(e),f("Error al procesar la transacci\xf3n")}finally{h(!1)}},E="ingreso"===q.type?x:m;return t.jsx("div",{className:"max-w-xl mx-auto p-4",children:(0,t.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(i.z,{type:"button",variant:"ghost",onClick:()=>e.back(),size:"sm",children:[t.jsx(l.Z,{size:16})," Volver"]}),t.jsx("h1",{className:"text-2xl font-bold",children:"Nueva transacci\xf3n"})]}),t.jsx("div",{className:"flex gap-4",children:["ingreso","gasto"].map(e=>(0,t.jsxs)("label",{className:`flex-1 text-center p-3 border rounded cursor-pointer ${q.type===e?"ingreso"===e?"bg-green-50 border-green-500":"bg-red-50 border-red-500":"hover:bg-muted/50"}`,children:[t.jsx("input",{type:"radio",name:"type",value:e,checked:q.type===e,onChange:P,className:"sr-only"}),"ingreso"===e?"Ingreso":"Gasto"]},e))}),(0,t.jsxs)("div",{children:[t.jsx("label",{htmlFor:"amount",children:"Monto"}),(0,t.jsxs)("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:"$"}),t.jsx(c.I,{id:"amount",name:"amount",type:"number",step:"0.01",min:"0",value:q.amount,onChange:P,className:"pl-8",required:!0})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{htmlFor:"category",children:"Categor\xeda"}),(0,t.jsxs)("select",{id:"category",name:"category",value:q.category,onChange:P,className:"w-full border rounded p-2",required:!0,children:[t.jsx("option",{value:"",children:"Selecciona una categor\xeda"}),E.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{htmlFor:"description",children:"Descripci\xf3n"}),t.jsx("textarea",{id:"description",name:"description",value:q.description,onChange:P,className:"w-full border rounded p-2",rows:3})]}),(0,t.jsxs)("div",{className:"relative",children:[t.jsx("label",{htmlFor:"date",children:"Fecha"}),t.jsx(c.I,{id:"date",name:"date",type:"date",value:q.date,onChange:P,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"inline-flex items-center",children:[t.jsx("input",{type:"checkbox",name:"isRecurrent",checked:q.isRecurrent,onChange:P,className:"mr-2"}),"Transacci\xf3n recurrente"]}),q.isRecurrent&&(0,t.jsxs)("select",{name:"recurrenceFrequency",value:q.recurrenceFrequency,onChange:P,className:"w-full border rounded p-2 mt-2",children:[t.jsx("option",{value:"none",children:"Selecciona frecuencia"}),t.jsx("option",{value:"daily",children:"Diaria"}),t.jsx("option",{value:"weekly",children:"Semanal"}),t.jsx("option",{value:"monthly",children:"Mensual"}),t.jsx("option",{value:"yearly",children:"Anual"})]})]}),(0,t.jsxs)("div",{children:[t.jsx("label",{children:"Etiquetas"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(d,{className:"mt-2"}),t.jsx(c.I,{value:j,onChange:e=>w(e.target.value),placeholder:"Nueva etiqueta"}),t.jsx(i.z,{type:"button",variant:"outline",onClick:()=>{j&&!q.tags.includes(j)&&(S(e=>({...e,tags:[...e.tags,j]})),w(""))},disabled:!j,children:"A\xf1adir"})]}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:q.tags.map(e=>(0,t.jsxs)("span",{className:"flex items-center bg-secondary px-3 py-1 rounded-full",children:[e,t.jsx("button",{onClick:()=>N(e),className:"ml-2",children:"\xd7"})]},e))})]}),y&&t.jsx("div",{className:"text-destructive",children:y}),b&&t.jsx("div",{className:"text-green-600",children:"Transacci\xf3n creada con \xe9xito."}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[t.jsx(i.z,{variant:"outline",onClick:()=>e.back(),children:"Cancelar"}),t.jsx(i.z,{type:"submit",disabled:g,children:g?(0,t.jsxs)(t.Fragment,{children:[t.jsx(u.Z,{className:"animate-spin mr-2"})," ","Guardando..."]}):"Guardar"})]})]})})}},46540:(e,r,a)=>{"use strict";a.d(r,{I:()=>o});var t=a(95344),s=a(3729),n=a(11453);let o=s.forwardRef(({className:e,type:r,...a},s)=>t.jsx("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));o.displayName="Input"},23595:(e,r,a)=>{let t=a(11185),s=new t.Schema({user:{type:t.Schema.Types.ObjectId,ref:"User",required:!0},type:{type:String,enum:["ingreso","gasto"],required:[!0,"El tipo de transacci\xf3n es requerido"]},amount:{type:Number,required:[!0,"El monto es requerido"]},category:{type:String,required:[!0,"La categor\xeda es requerida"]},description:{type:String,default:""},date:{type:Date,default:Date.now},isRecurrent:{type:Boolean,default:!1},recurrenceFrequency:{type:String,enum:["none","daily","weekly","monthly","yearly"],default:"none"},tags:{type:[String],default:[]}});s.index({user:1,date:-1}),s.index({user:1,category:1}),s.index({user:1,type:1}),e.exports=t.models.Transaction||t.model("Transaction",s)},91063:(e,r,a)=>{let t=a(11185),s=a(30634),n=new t.Schema({name:{type:String,required:[!0,"Por favor proporciona un nombre"],trim:!0},email:{type:String,required:[!0,"Por favor proporciona un email"],unique:!0,lowercase:!0,match:[/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,"Por favor proporciona un email v\xe1lido"]},password:{type:String,required:[!0,"Por favor proporciona una contrase\xf1a"],minlength:6,select:!1},monthlyIncome:{type:Number,default:0},monthlyExpenses:{type:Number,default:0},mainExpenseCategories:{type:[String],default:[]},savingsGoal:{type:Number,default:0},referralSource:{type:String,default:""},createdAt:{type:Date,default:Date.now},isOnboarded:{type:Boolean,default:!1}});n.pre("save",async function(e){this.isModified("password")||e();let r=await s.genSalt(10);this.password=await s.hash(this.password,r)}),n.methods.matchPassword=async function(e){return await s.compare(e,this.password)},e.exports=t.models.User||t.model("User",n)},85556:(e,r,a)=>{"use strict";a.r(r),a.d(r,{createTransaction:()=>l});var t=a(98601);a(75811);var s=a(12422),n=a(68474),o=a(41783),i=a(23595),c=a.n(i);async function l(e){let r=await (0,s.getServerSession)(n.authOptions);if(!r?.user?.id)return{success:!1,error:"No autenticado"};try{await (0,o.default)();let a={type:"",amount:0,category:"",description:"",date:"",isRecurrent:!1,recurrenceFrequency:"none",tags:[],user:r.user.id};e.forEach((e,r)=>{switch(r){case"amount":a.amount=parseFloat(e.toString());break;case"isRecurrent":a.isRecurrent="on"===e;break;case"tags":a.tags.push(e.toString());break;default:a[r]=e.toString()}});let t=await c().create(a);return{success:!0,data:t}}catch(e){return console.error("createTransaction error:",e),{success:!1,error:"Error interno al crear la transacci\xf3n"}}}(0,a(46893).ensureServerEntryExports)([l]),(0,t.createActionProxy)("5267d4393e59df6dc3ad8be98008f0631733a9a6",l)},65814:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>l});var t=a(25036);let s=(0,a(86843).createProxy)(String.raw`/Users/salomon/Documents/Projects/kipo-app/src/components/TxForm.tsx`),{__esModule:n,$$typeof:o}=s,i=s.default;var c=a(79316);function l(){return t.jsx(c.m$,{children:t.jsx(i,{})})}},68474:(e,r,a)=>{"use strict";a.d(r,{authOptions:()=>l});var t=a(63130),s=a(41783),n=a(91063),o=a.n(n),i=a(30634),c=a.n(i);let l={providers:[(0,t.default)({id:"credentials",name:"Credenciales",credentials:{email:{label:"Email",type:"email"},password:{label:"Contrase\xf1a",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email y contrase\xf1a son requeridos");await (0,s.connectToDatabase)();let r=await o().findOne({email:e.email}).select("+password");if(!r)throw Error("Usuario no encontrado");if(!await c().compare(e.password,r.password))throw Error("Contrase\xf1a incorrecta");return{id:r._id.toString(),name:r.name,email:r.email,isOnboarded:r.isOnboarded}}})],pages:{signIn:"/login",error:"/login"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.isOnboarded=r.isOnboarded),e),session:async({session:e,token:r})=>(r&&(e.user={...e.user,id:r.id,isOnboarded:r.isOnboarded}),e)},session:{strategy:"jwt",maxAge:2592e3},secret:process.env.NEXTAUTH_SECRET,debug:!1}},41783:(e,r,a)=>{"use strict";a.d(r,{connectToDatabase:()=>i,default:()=>c});var t=a(11185),s=a.n(t);let n=process.env.MONGODB_URI;if(!n)throw Error("Por favor define la variable de entorno MONGODB_URI dentro de .env.local");let o=global.mongoose;async function i(){return o.conn||(o.promise||(o.promise=s().connect(n,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(e=>e)),o.conn=await o.promise),o.conn}o||(o=global.mongoose={conn:null,promise:null});let c=i},79316:(e,r,a)=>{"use strict";a.d(r,{m$:()=>i});var t=a(86843);let s=(0,t.createProxy)(String.raw`/Users/salomon/Documents/Projects/kipo-app/src/store/index.tsx`),{__esModule:n,$$typeof:o}=s;s.default,(0,t.createProxy)(String.raw`/Users/salomon/Documents/Projects/kipo-app/src/store/index.tsx#store`);let i=(0,t.createProxy)(String.raw`/Users/salomon/Documents/Projects/kipo-app/src/store/index.tsx#ReduxProvider`)}};var r=require("../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[638,621,969,476,506,181,697,141],()=>a(45104));module.exports=t})();